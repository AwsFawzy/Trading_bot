{% extends "base.html" %}

{% block title %}ุงุฎุชุจุงุฑ ุชูููุฐ ุงูุตููุงุช - ุจูุช ุชุฏุงูู ุงูุนููุงุช ุงูุฑูููุฉ{% endblock %}

{% block content %}
<div class="container">
    <h2 class="text-center mb-4">ุงุฎุชุจุงุฑ ุชูููุฐ ุงูุตููุงุช</h2>
    
    <div class="card mb-4">
        <div class="card-header bg-primary text-white">
            <h5 class="mb-0">ุงุฎุชุจุงุฑ ุชูููุฐ ุฃูุฑ ุชุฏุงูู</h5>
        </div>
        <div class="card-body">
            <p class="alert alert-info">
                ุงุณุชุฎุฏู ูุฐู ุงูุตูุญุฉ ูุงุฎุชุจุงุฑ ุชูููุฐ ุฃูุฑ ุชุฏุงูู ุญูููู ุจูููุฉ ุตุบูุฑุฉ ุฌุฏูุง ููุชุฃูุฏ ูู ุนูู ูุงุฌูุฉ ุจุฑูุฌุฉ ุงูุชุทุจููุงุช (API) ุจุดูู ุตุญูุญ.
                <br>
                <strong>ููุงุญุธุฉ ูุงูุฉ:</strong> ุณูุชู ุชูููุฐ ุฃูุฑ ุดุฑุงุก ุซู ุจูุน ููุฑู ููุชุฃูุฏ ูู ุนุฏู ุชุฑู ุฃู ุนููุงุช ูู ุงููุญูุธุฉ.
            </p>
            
            <form method="post" action="{{ url_for('test_trade') }}">
                <div class="row mb-3">
                    <div class="col-md-4">
                        <label for="symbol" class="form-label">ุฑูุฒ ุงูุนููุฉ:</label>
                        <input type="text" id="symbol" name="symbol" class="form-control" value="{{ symbol or 'BTCUSDT' }}" required>
                        <small class="text-muted">ูุซุงู: BTCUSDTุ ETHUSDTุ DOGEUSDT</small>
                    </div>
                    <div class="col-md-4">
                        <label for="quantity" class="form-label">ุงููููุฉ:</label>
                        <input type="number" id="quantity" name="quantity" class="form-control" value="{{ quantity or 0.0001 }}" step="0.0001" min="0.0001" required>
                        <small class="text-muted">ุงุณุชุฎุฏู ูููุฉ ุตุบูุฑุฉ ุฌุฏูุง ููุงุฎุชุจุงุฑ (0.0001 ุฃู ุฃูู)</small>
                    </div>
                    <div class="col-md-4">
                        <label for="trade_type" class="form-label">ููุน ุงูุตููุฉ:</label>
                        <select id="trade_type" name="trade_type" class="form-select">
                            <option value="BUY" {% if trade_type == 'BUY' %}selected{% endif %}>ุดุฑุงุก (BUY)</option>
                            <option value="SELL" {% if trade_type == 'SELL' %}selected{% endif %}>ุจูุน (SELL)</option>
                        </select>
                        <small class="text-muted">ุงุฎุชุฑ ููุน ุงูุตููุฉ ุงูุงุฎุชุจุงุฑูุฉ</small>
                    </div>
                </div>
                
                <div class="d-grid">
                    <button type="submit" class="btn btn-primary">ุชูููุฐ ุงุฎุชุจุงุฑ ุงูุชุฏุงูู</button>
                </div>
            </form>
        </div>
    </div>
    
    {% if result %}
    <div class="card mb-4">
        <div class="card-header bg-{{ 'success' if result.success else 'danger' }} text-white">
            <h5 class="mb-0">ูุชูุฌุฉ ุงูุงุฎุชุจุงุฑ: {{ 'ูุงุฌุญ โ' if result.success else 'ูุงุดู โ' }}</h5>
        </div>
        <div class="card-body">
            {% if result.success %}
                <div class="alert alert-success">
                    <h4>ุชู ุชูููุฐ ุงูุตููุฉ ุจูุฌุงุญ! ๐</h4>
                    <p>ูุนุฑู ุงูุฃูุฑ: <strong>{{ result.test_details.order_id }}</strong></p>
                    <p>ุงููููุฉ ุงููููุฐุฉ: <strong>{{ result.test_details.executed_qty }}</strong></p>
                </div>
                
                {% if result.test_details.sell_result %}
                <div class="alert alert-info">
                    <h4>ุชู ุจูุน ุงููููุฉ ุงููุดุชุฑุงุฉ ุจูุฌุงุญ:</h4>
                    <p>ูุนุฑู ุฃูุฑ ุงูุจูุน: <strong>{{ result.test_details.sell_result.orderId }}</strong></p>
                </div>
                {% endif %}
                
            {% else %}
                <div class="alert alert-danger">
                    <h4>ูุดู ุชูููุฐ ุงูุตููุฉ:</h4>
                    <p><strong>{{ result.error }}</strong></p>
                </div>
            {% endif %}
            
            <h5 class="mt-4">ุชูุงุตูู ุงูุงุฎุชุจุงุฑ:</h5>
            <div class="table-responsive">
                <table class="table table-striped">
                    <tr>
                        <th>ุงูุนููุฉ</th>
                        <td>{{ symbol }}</td>
                    </tr>
                    <tr>
                        <th>ุงููููุฉ</th>
                        <td>{{ quantity }}</td>
                    </tr>
                    {% if result.test_details.current_price %}
                    <tr>
                        <th>ุงูุณุนุฑ ุงูุญุงูู</th>
                        <td>{{ result.test_details.current_price }}</td>
                    </tr>
                    {% endif %}
                    {% if result.test_details.balance %}
                    <tr>
                        <th>ุงูุฑุตูุฏ ุงููุชุงุญ</th>
                        <td>{{ result.test_details.balance }} USDT</td>
                    </tr>
                    {% endif %}
                    {% if result.test_details.estimated_cost %}
                    <tr>
                        <th>ุงูุชูููุฉ ุงูุชูุฏูุฑูุฉ</th>
                        <td>{{ result.test_details.estimated_cost }} USDT</td>
                    </tr>
                    {% endif %}
                </table>
            </div>
            
            <h5 class="mt-4">ุตูุงุญูุงุช API:</h5>
            <div class="table-responsive">
                <table class="table table-striped">
                    <tr>
                        <th>ูุฌูุฏ ุงูููุงุชูุญ</th>
                        <td>{{ 'โ ููุฌูุฏุฉ' if result.test_details.permissions.has_keys else 'โ ุบูุฑ ููุฌูุฏุฉ' }}</td>
                    </tr>
                    <tr>
                        <th>ุตูุงุญูุฉ ุงููุฑุงุกุฉ</th>
                        <td>{{ 'โ ูุชุงุญุฉ' if result.test_details.permissions.read_permission else 'โ ุบูุฑ ูุชุงุญุฉ' }}</td>
                    </tr>
                    <tr>
                        <th>ุตูุงุญูุฉ ุงูุชุฏุงูู</th>
                        <td>{{ 'โ ูุชุงุญุฉ' if result.test_details.permissions.trade_permission else 'โ ุบูุฑ ูุชุงุญุฉ' }}</td>
                    </tr>
                </table>
            </div>
            
            <h5 class="mt-4">ุงุณุชุฌุงุจุฉ API:</h5>
            <div class="card">
                <div class="card-body">
                    <pre class="mb-0">{{ result.api_result }}</pre>
                </div>
            </div>
        </div>
    </div>
    {% endif %}
    
    <div class="card mb-4">
        <div class="card-header bg-info text-white">
            <h5 class="mb-0">ูุนูููุงุช ูุงูุฉ</h5>
        </div>
        <div class="card-body">
            <p>ูู ุญุงู ูุฌุงุญ ุงูุงุฎุชุจุงุฑุ ููููู ุงูุงุทูุฆูุงู ุฃู:</p>
            <ul>
                <li>ููุงุชูุญ API ุชุนูู ุจุดูู ุตุญูุญ</li>
                <li>ุตูุงุญูุงุช ุงูุชุฏุงูู ููุนูุฉ</li>
                <li>ุงูุจูุช ูุงุฏุฑ ุนูู ุชูููุฐ ุตููุงุช ุญููููุฉ</li>
            </ul>
            
            <p>ูู ุญุงู ูุดู ุงูุงุฎุชุจุงุฑุ ุชุญูู ูู:</p>
            <ul>
                <li>ุตุญุฉ ููุงุชูุญ API</li>
                <li>ุชูุนูู ุตูุงุญูุงุช ุงูุชุฏุงูู ูู ููุตุฉ MEXC</li>
                <li>ูุฌูุฏ ุฑุตูุฏ ูุงูู ููุชุฏุงูู</li>
                <li>ุฑูุฒ ุงูุนููุฉ ูุฏุนูู ููุชุฏุงูู</li>
            </ul>
            
            <div class="alert alert-danger mt-3">
                <p><strong>ุงุฎุชุจุงุฑ ุงูุจูุน:</strong> ุฅุฐุง ููุช ุชูุงุฌู ูุดุงูู ูู ูุธููุฉ ุงูุจูุนุ ููููู ุงุณุชุฎุฏุงู <a href="{{ url_for('test_sell') }}" class="alert-link">ุตูุญุฉ ุงุฎุชุจุงุฑ ุงูุจูุน ุงููุฎุตุตุฉ</a> ูุชุดุฎูุต ุงููุดููุฉ ุจุดูู ุฃูุถู.</p>
            </div>
        </div>
    </div>
</div>
{% endblock %}